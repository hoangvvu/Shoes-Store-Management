package gui;

import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import model.NhanVien;

public class MAINFRAME extends JFrame {
    private NhanVien currentUser;
    private JPanel mainMenuPanel; // menu ch√≠nh
    private JPanel contentPanel;  // ch·ª©a t·∫•t c·∫£ c√°c panel
    private CardLayout cardLayout;
    private JLabel lblWelcome;
    private JMenuBar menuBar;

    public MAINFRAME(NhanVien user) {
        this.currentUser = user;
        initComponents();
        setLocationRelativeTo(null);
    }

    private void initComponents() {
        setTitle("H·ªá Th·ªëng Qu·∫£n L√Ω C·ª≠a H√†ng Gi√†y");
        setSize(1200, 700);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setExtendedState(JFrame.MAXIMIZED_BOTH);

        // ============= S·ª¨ D·ª§NG CARDLAYOUT =============
        cardLayout = new CardLayout();
        contentPanel = new JPanel(cardLayout);
        add(contentPanel, BorderLayout.CENTER);

        // ============= T·∫†O MENU BAR =============
        createMenuBar();

        // ============= PANEL MENU CH√çNH =============
        mainMenuPanel = createMainMenuPanel();
        contentPanel.add(mainMenuPanel, "menu");

        // ============= PANEL QU·∫¢N L√ù GI√ÄY =============
        contentPanel.add(new QuanLyGiay(), "giay");

        // Hi·ªÉn th·ªã menu ch√≠nh ƒë·∫ßu ti√™n
        showMainMenuPanel();
    }

    private JPanel createMainMenuPanel() {
        JPanel mainPanel = new JPanel(new BorderLayout());
        mainPanel.setBackground(new Color(236, 240, 241));

        // Header
        JPanel headerPanel = new JPanel(new BorderLayout());
        headerPanel.setBackground(new Color(52, 73, 94));
        headerPanel.setPreferredSize(new Dimension(0, 60));
        headerPanel.setBorder(BorderFactory.createEmptyBorder(10, 20, 10, 20));

        JLabel lblTitle = new JLabel("H·ªÜ TH·ªêNG QU·∫¢N L√ù C·ª¨A H√ÄNG GI√ÄY");
        lblTitle.setFont(new Font("Segoe UI", Font.BOLD, 24));
        lblTitle.setForeground(Color.WHITE);
        headerPanel.add(lblTitle, BorderLayout.WEST);

        // B√™n ph·∫£i: l·ªùi ch√†o + n√∫t ƒëƒÉng xu·∫•t
        JPanel rightPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT, 10, 5));
        rightPanel.setBackground(new Color(52, 73, 94));

        lblWelcome = new JLabel("Xin ch√†o: " + currentUser.getTenNV() +
                " (" + currentUser.getPhanQuyen() + ")");
        lblWelcome.setFont(new Font("Segoe UI", Font.PLAIN, 14));
        lblWelcome.setForeground(Color.WHITE);

        JButton btnLogout = new JButton("ƒêƒÉng Xu·∫•t");
        btnLogout.setFocusPainted(false);
        btnLogout.setBackground(Color.WHITE); // n·ªÅn tr·∫Øng
        btnLogout.setForeground(Color.RED);   // ch·ªØ ƒë·ªè
        btnLogout.setFont(new Font("Segoe UI", Font.BOLD, 13));
        btnLogout.setBorder(BorderFactory.createEmptyBorder(5, 15, 5, 15)); // b·ªè vi·ªÅn
        btnLogout.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        btnLogout.addActionListener(e -> handleLogout());

        rightPanel.add(lblWelcome);
        rightPanel.add(btnLogout);
        headerPanel.add(rightPanel, BorderLayout.EAST);
        mainPanel.add(headerPanel, BorderLayout.NORTH);

        // Center
        JPanel centerPanel = new JPanel(new GridLayout(2, 3, 20, 20));
        centerPanel.setBackground(new Color(236, 240, 241));
        centerPanel.setBorder(BorderFactory.createEmptyBorder(30, 30, 30, 30));

        centerPanel.add(createDashboardCard("Qu·∫£n L√Ω Nh√¢n Vi√™n", new Color(52, 152, 219), null));
        centerPanel.add(createDashboardCard("Qu·∫£n L√Ω Kh√°ch H√†ng", new Color(46, 204, 113), null));
        centerPanel.add(createDashboardCard("Qu·∫£n L√Ω Gi√†y", new Color(155, 89, 182), "giay"));
        centerPanel.add(createDashboardCard("Qu·∫£n L√Ω H√≥a ƒê∆°n", new Color(230, 126, 34), null));
        centerPanel.add(createDashboardCard("Qu·∫£n L√Ω Nh·∫≠p Kho", new Color(231, 76, 60), null));
        centerPanel.add(createDashboardCard("Th·ªëng K√™ B√°o C√°o", new Color(26, 188, 156), null));

        mainPanel.add(centerPanel, BorderLayout.CENTER);

        // Footer
        JPanel footerPanel = new JPanel();
        footerPanel.setBackground(new Color(52, 73, 94));
        footerPanel.setPreferredSize(new Dimension(0, 30));

        JLabel lblFooter = new JLabel("¬© 2024 Shoe Store Management System - Version 1.0");
        lblFooter.setForeground(Color.WHITE);
        lblFooter.setFont(new Font("Segoe UI", Font.PLAIN, 12));
        footerPanel.add(lblFooter);

        mainPanel.add(footerPanel, BorderLayout.SOUTH);

        return mainPanel;
    }

    private JPanel createDashboardCard(String title, Color color, String action) {
        JPanel card = new JPanel(new BorderLayout());
        card.setBackground(Color.WHITE);
        card.setBorder(BorderFactory.createCompoundBorder(
                BorderFactory.createLineBorder(new Color(189, 195, 199), 1),
                BorderFactory.createEmptyBorder(20, 20, 20, 20)
        ));
        card.setCursor(new Cursor(Cursor.HAND_CURSOR));

        JLabel lblTitle = new JLabel(title, SwingConstants.CENTER);
        lblTitle.setFont(new Font("Segoe UI", Font.BOLD, 18));
        lblTitle.setForeground(color);

        card.add(lblTitle, BorderLayout.CENTER);

        card.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseEntered(MouseEvent e) {
                card.setBackground(new Color(245, 245, 245));
            }

            @Override
            public void mouseExited(MouseEvent e) {
                card.setBackground(Color.WHITE);
            }

            @Override
            public void mouseClicked(MouseEvent e) {
                if ("giay".equals(action)) {
                    showQuanLyGiayPanel();
                } else {
                    JOptionPane.showMessageDialog(MAINFRAME.this,
                            "Ch·ª©c nƒÉng " + title + " ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn!",
                            "Th√¥ng b√°o",
                            JOptionPane.INFORMATION_MESSAGE);
                }
            }
        });
        return card;
    }

    private void createMenuBar() {
        menuBar = new JMenuBar();
        menuBar.setBackground(new Color(44, 62, 80));

        JMenu menuSystem = new JMenu("H·ªá Th·ªëng");
        menuSystem.setForeground(Color.WHITE);
        menuSystem.setFont(new Font("Segoe UI", Font.BOLD, 14));

        JMenuItem itemLogout = new JMenuItem("ƒêƒÉng Xu·∫•t");
        JMenuItem itemExit = new JMenuItem("Tho√°t");

        itemLogout.addActionListener(e -> handleLogout());
        itemExit.addActionListener(e -> handleExit());

        menuSystem.add(itemLogout);
        menuSystem.add(itemExit);
        menuBar.add(menuSystem);

        setJMenuBar(menuBar);
    }

    private void handleLogout() {
        int choice = JOptionPane.showConfirmDialog(this,
                "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?",
                "X√°c nh·∫≠n",
                JOptionPane.YES_NO_OPTION);

        if (choice == JOptionPane.YES_OPTION) {
            this.dispose();
            new LoginForm().setVisible(true);
        }
    }

    private void handleExit() {
        int choice = JOptionPane.showConfirmDialog(this,
                "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën tho√°t ch∆∞∆°ng tr√¨nh?",
                "X√°c nh·∫≠n",
                JOptionPane.YES_NO_OPTION);

        if (choice == JOptionPane.YES_OPTION) {
            System.exit(0);
        }
    }

    // üëâ Chuy·ªÉn v·ªÅ menu ch√≠nh
    public void showMainMenuPanel() {
        cardLayout.show(contentPanel, "menu");
    }

    // üëâ Hi·ªÉn th·ªã panel Qu·∫£n l√Ω gi√†y
    public void showQuanLyGiayPanel() {
        cardLayout.show(contentPanel, "giay");
    }
}
